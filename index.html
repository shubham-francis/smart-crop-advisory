<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Crop Advisory</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      display: flex;
      justify-content: center;
      padding-top: 40px;
    }
    .card {
      background: white;
      padding: 20px;
      width: 380px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      color: #2e7d32;
    }
    input, button {
      width: 100%;
      padding: 8px;
      margin-top: 10px;
    }
    button {
      background: #2e7d32;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 15px;
    }
    button:hover {
      background: #1b5e20;
    }
    .output {
      margin-top: 15px;
      padding: 10px;
      background: #eef7ee;
      border-radius: 5px;
    }
  </style>
</head>

<body>
  <div class="card">
    <h2>ğŸŒ¾ Smart Crop Advisory</h2>

    <input id="N" type="number" placeholder="Nitrogen (N)">
    <input id="P" type="number" placeholder="Phosphorus (P)">
    <input id="K" type="number" placeholder="Potassium (K)">
    <input id="ph" type="number" step="0.1" placeholder="Soil pH">

    <button onclick="getPrediction()">Detect Location & Predict</button>

    <div class="output" id="result" style="display:none;"></div>
  </div>

<script>
function getPrediction() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported");
    return;
  }

  navigator.geolocation.getCurrentPosition(position => {
    const data = {
      lat: position.coords.latitude,
      lon: position.coords.longitude,
      N: Number(document.getElementById("N").value),
      P: Number(document.getElementById("P").value),
      K: Number(document.getElementById("K").value),
      ph: Number(document.getElementById("ph").value)
    };

    fetch("http://127.0.0.1:8000/predict", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(data)
    })
    .then(res => res.json())
    .then(res => {
      document.getElementById("result").style.display = "block";
      document.getElementById("result").innerHTML = `
        <b>ğŸŒ± Crop:</b> ${res.recommended_crop}<br>
        <b>ğŸ§ª Fertilizer:</b> ${res.fertilizer}<br><br>
        <b>ğŸŒ¦ï¸ Weather</b><br>
        Temp: ${res.weather.temperature} Â°C<br>
        Humidity: ${res.weather.humidity} %<br>
        Rainfall: ${res.weather.rainfall} mm
      `;
    })
    .catch(err => {
      alert("Backend not reachable");
      console.error(err);
    });
  }, () => {
    alert("Location permission denied");
  });
}
</script>
</body>
</html>
